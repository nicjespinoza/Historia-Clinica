const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FloatingLabelInput-yKyd0NR2.js","assets/index-BUr3TCdC.js","assets/ui-BmRGmjZq.js","assets/vendor-DTmQ9CDn.js","assets/firebase-BYKe8LDu.js","assets/index-C1U6yT1Q.css","assets/utils-CDN07tui.js"])))=>i.map(i=>d[i]);
import{a as Q,d as l,_,s as X}from"./index-BUr3TCdC.js";import{a as w,d as g,b as T,c as p,e as N,u as O,q as A,l as L,o as D,w as E,f as b,s as Z,r as ee,h as te,i as ae}from"./firebase-BYKe8LDu.js";import{j as t,O as q,q as $,V as se,Q as ie,X as k,U as re,Y as oe,_ as ne,R as ce,C as le,$ as de,a0 as ue,t as me}from"./ui-BmRGmjZq.js";import{r as j}from"./vendor-DTmQ9CDn.js";import{F as f}from"./FloatingLabelInput-yKyd0NR2.js";const M=async e=>{try{const a=Q.currentUser;let i="unknown",o="unknown";if(a){o=a.email||"no-email";try{const s=await w(g(l,"users",a.uid));s.exists()&&(i=s.data().role||"unknown")}catch{}}await T(p(l,"auditLogs"),{...e,userId:(a==null?void 0:a.uid)||"anonymous",userEmail:o,userRole:i,timestamp:new Date().toISOString(),userAgent:navigator.userAgent})}catch(a){console.error("Failed to write audit log:",a)}};class pe{constructor(){this.cache=new Map,this.defaultTTL=300*1e3}async getOrFetch(a,i,o=this.defaultTTL){const s=this.cache.get(a),c=Date.now();if(s&&c<s.expiresAt)return s.data;const n=await i();return this.cache.set(a,{data:n,timestamp:c,expiresAt:c+o}),n}invalidate(a){this.cache.delete(a)}invalidatePattern(a){const i=new RegExp(a);for(const o of this.cache.keys())i.test(o)&&this.cache.delete(o)}clear(){this.cache.clear()}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}const v=new pe,he={patients:20},ge={maxWidth:1920,maxHeight:1080,quality:.8,format:"webp"},fe=async(e,a={})=>{const i={...ge,...a};return!e.type.startsWith("image/")||e.size<100*1024?e:new Promise((o,s)=>{const c=new Image,n=document.createElement("canvas"),u=n.getContext("2d");c.onload=()=>{let{width:m,height:r}=c;const d=i.maxWidth,x=i.maxHeight;if(m>d||r>x){const y=Math.min(d/m,x/r);m=Math.round(m*y),r=Math.round(r*y)}n.width=m,n.height=r,u==null||u.drawImage(c,0,0,m,r),n.toBlob(y=>{if(y){const I=new File([y],e.name.replace(/\.[^.]+$/,`.${i.format}`),{type:`image/${i.format}`});console.log(`ðŸ“¸ Image compressed: ${U(e.size)} â†’ ${U(I.size)} (${Math.round((1-I.size/e.size)*100)}% savings)`),o(I)}else s(new Error("Failed to compress image"))},`image/${i.format}`,i.quality)},c.onerror=()=>s(new Error("Failed to load image")),c.src=URL.createObjectURL(e)})},U=e=>e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`,Ee=(e,a)=>{let i=null;return(...o)=>{i&&clearTimeout(i),i=setTimeout(()=>e(...o),a)}},be=e=>e&&typeof e=="object"&&typeof e.toDate=="function",z=e=>{if(!e||typeof e!="object")return e;if(be(e))return e.toDate().toISOString();if(!Array.isArray(e)&&e.seconds!==void 0&&e.nanoseconds!==void 0&&Object.keys(e).length<=2)return new Date(e.seconds*1e3).toISOString();if(Array.isArray(e))return e.map(i=>z(i));const a={};return Object.keys(e).forEach(i=>{a[i]=z(e[i])}),a},h=e=>{const a=e.data(),i=z(a),{id:o,...s}=i;return{id:e.id,...s}},Se={getPatients:async()=>v.getOrFetch("patients:all_v3",async()=>{const e=A(p(l,"patients"),D("createdAt","desc"));return(await b(e)).docs.map(i=>h(i))},300*1e3),getPatientsPaginated:async(e=he.patients,a)=>{let i=A(p(l,"patients"),D("createdAt","desc"),L(e+1));a&&(i=A(p(l,"patients"),D("createdAt","desc"),Z(a),L(e+1)));const s=(await b(i)).docs,c=s.length>e,n=c?s.slice(0,-1):s;return{data:n.map(u=>h(u)),lastDoc:n[n.length-1]||null,hasMore:c,totalFetched:n.length}},createPatient:async e=>{const{id:a,...i}=e,o=await T(p(l,"patients"),{...i,createdAt:new Date().toISOString()});return v.invalidate("patients:all_v3"),await M({action:"CREATE_PATIENT",details:`Created patient ${i.firstName} ${i.lastName}`,targetId:o.id}),{id:o.id,...i}},updatePatient:async(e,a)=>{const i=g(l,"patients",e);await O(i,a),v.invalidate("patients:all_v3");const o=await w(i);return h(o)},deletePatient:async e=>{const a=g(l,"patients",e),i=["histories","consults","observations","snapshots"];for(const n of i){const u=await b(p(l,"patients",e,n));await _(()=>import("./firebase-BYKe8LDu.js").then(r=>r.S),[]).then(r=>{const d=r.writeBatch(l);return u.docs.forEach(x=>d.delete(x.ref)),d.commit()})}const o=A(p(l,"appointments"),E("patientId","==",e)),s=await b(o);await _(()=>import("./firebase-BYKe8LDu.js").then(n=>n.S),[]).then(n=>{const u=n.writeBatch(l);return s.docs.forEach(m=>u.delete(m.ref)),u.commit()}),await N(a),await N(a),v.invalidate("patients:all_v3"),v.invalidatePattern("^appointments:"),await M({action:"DELETE_PATIENT",details:`Deleted patient ${e} and all related data`,targetId:e})},getPatient:async e=>{const a=g(l,"patients",e),i=await w(a);return i.exists()?h(i):null},getPatientStatus:async e=>{const a=g(l,"patients",e),i=await w(a);if(!i.exists())return{canChat:!1};const o=i.data();return{canChat:(o==null?void 0:o.isOnline)??!1}},getHistories:async e=>{if(e){const o=p(l,"patients",e,"histories"),c=(await b(o)).docs.map(d=>h(d)),n=A(p(l,"initialHistories"),E("patientId","==",e)),m=(await b(n)).docs.map(d=>h(d));return[...c,...m].sort((d,x)=>new Date(x.date).getTime()-new Date(d.date).getTime())}const a=await b(p(l,"patients")),i=[];for(const o of a.docs){const s=await b(p(l,"patients",o.id,"histories"));i.push(...s.docs.map(c=>h(c)))}return i},createHistory:async e=>{const a=await T(p(l,"patients",e.patientId,"histories"),e);try{await M({action:"CREATE_HISTORY",details:`Created history for patient ${e.patientId}`,targetId:a.id,metadata:{patientId:e.patientId}})}catch(i){console.warn("Offline: Audit log queued or failed",i)}return{id:a.id,...e}},updateHistory:async(e,a)=>{if(!a.patientId)throw new Error("patientId required to update history");try{const i=g(l,"patients",a.patientId,"histories",e);await O(i,a);const o=await w(i);return h(o)}catch{try{const o=g(l,"initialHistories",e);await O(o,a);const s=await w(o);return h(s)}catch{throw new Error("History not found in either location")}}},deleteHistory:async(e,a)=>{if(!a)throw new Error("Patient ID required for deletion");const i=g(l,"patients",a,"histories",e);if((await w(i)).exists()){await N(i);return}const s=g(l,"initialHistories",e);if((await w(s)).exists()){await N(s);return}},getConsult:async(e,a)=>{try{const i=g(l,"patients",e,"consults",a),o=await w(i);if(o.exists())return h(o)}catch(i){console.warn("Could not fetch from subcollection, checking root:",i.message)}try{const i=g(l,"subsequentConsults",a),o=await w(i);if(o.exists()){const s=h(o);if(s.patientId===e)return s}}catch(i){console.error("Error fetching from root collection:",i)}return null},getConsults:async e=>{if(e){const s=(await b(p(l,"patients",e,"consults"))).docs.map(r=>h(r)),c=A(p(l,"subsequentConsults"),E("patientId","==",e)),u=(await b(c)).docs.map(r=>h(r));return[...s,...u].sort((r,d)=>{const x=new Date(`${r.date}T${r.time||"00:00"}`);return new Date(`${d.date}T${d.time||"00:00"}`).getTime()-x.getTime()})}const a=await b(p(l,"patients")),i=[];for(const o of a.docs){const s=await b(p(l,"patients",o.id,"consults"));i.push(...s.docs.map(c=>h(c)))}return i},createConsult:async e=>{const a=await T(p(l,"patients",e.patientId,"consults"),e);try{await M({action:"CREATE_CONSULT",details:`Created consult for patient ${e.patientId}`,targetId:a.id,metadata:{patientId:e.patientId}})}catch(i){console.warn("Offline: Audit log queued or failed",i)}return{id:a.id,...e}},updateConsult:async(e,a)=>{if(!a.patientId)throw new Error("patientId required to update consult");try{const i=g(l,"patients",a.patientId,"consults",e);await O(i,a);const o=await w(i);return h(o)}catch{try{const o=g(l,"subsequentConsults",e);await O(o,a);const s=await w(o);return h(s)}catch{throw new Error("Consult not found in either location")}}},deleteConsult:async(e,a)=>{if(!a)throw new Error("Patient ID required for deletion");const i=g(l,"patients",a,"consults",e);if((await w(i)).exists()){await N(i);return}const s=g(l,"subsequentConsults",e);if((await w(s)).exists()){await N(s);return}},createObservation:async(e,a)=>({id:(await T(p(l,"patients",e,"observations"),{...a,createdAt:new Date().toISOString()})).id,...a}),getObservations:async(e,a)=>{const i=p(l,"patients",e,"observations");let o;if(a){const s=A(i,E("snapshotId","==",a));o=await b(s)}else o=await b(i);return o.docs.map(s=>h(s))},deleteObservation:async(e,a)=>(await N(g(l,"patients",e,"observations",a)),{success:!0}),createSnapshot:async(e,a)=>({id:(await T(p(l,"patients",e,"snapshots"),{name:a||`Snapshot ${new Date().toISOString()}`,createdAt:new Date().toISOString()})).id,name:a}),getSnapshots:async e=>(await b(p(l,"patients",e,"snapshots"))).docs.map(i=>h(i)),deleteSnapshot:async(e,a)=>(await N(g(l,"patients",e,"snapshots",a)),{success:!0}),getAppointments:async()=>v.getOrFetch("appointments:all",async()=>{const e=A(p(l,"appointments"),D("date","desc"),L(100));return(await b(e)).docs.map(i=>h(i))},120*1e3),getAppointmentsByDateRange:async(e,a)=>{const i=`appointments:${e}:${a}`;return v.getOrFetch(i,async()=>{const o=A(p(l,"appointments"),E("date",">=",e),E("date","<=",a),D("date","asc"));return(await b(o)).docs.map(c=>h(c))},300*1e3)},getPatientAppointments:async e=>{const a=`appointments:patient:${e}`;return v.getOrFetch(a,async()=>{const i=A(p(l,"appointments"),E("patientId","==",e),D("date","desc"),L(20));return(await b(i)).docs.map(s=>h(s))},180*1e3)},createAppointment:async e=>{const a=`CITA-${Date.now()}`,i=await T(p(l,"appointments"),{...e,uniqueId:a,createdAt:new Date().toISOString()});return v.invalidatePattern("^appointments:"),{id:i.id,uniqueId:a,...e}},updateAppointment:async(e,a)=>{const i=g(l,"appointments",e);await O(i,a),v.invalidatePattern("^appointments:");const o=await w(i);return h(o)},deleteAppointment:async e=>{await N(g(l,"appointments",e)),v.invalidatePattern("^appointments:")},initiatePayment:async e=>{const{getFunctions:a,httpsCallable:i}=await _(async()=>{const{getFunctions:n,httpsCallable:u}=await import("./FloatingLabelInput-yKyd0NR2.js").then(m=>m.i);return{getFunctions:n,httpsCallable:u}},__vite__mapDeps([0,1,2,3,4,5,6])),o=a();return(await i(o,"initiatePayment")(e)).data},checkEmailAvailability:async e=>{const{getFunctions:a,httpsCallable:i}=await _(async()=>{const{getFunctions:n,httpsCallable:u}=await import("./FloatingLabelInput-yKyd0NR2.js").then(m=>m.i);return{getFunctions:n,httpsCallable:u}},__vite__mapDeps([0,1,2,3,4,5,6])),o=a();return(await i(o,"checkEmailAvailability")({email:e})).data},getUser:async e=>{const a=g(l,"users",e),i=await w(a);return i.exists()?h(i):null},setRole:async(e,a)=>{const i=g(l,"users",e),{setDoc:o}=await _(async()=>{const{setDoc:s}=await import("./firebase-BYKe8LDu.js").then(c=>c.S);return{setDoc:s}},[]);return await o(i,{role:a,updatedAt:new Date().toISOString()},{merge:!0}),{success:!0}}},Te=e=>{if(!e)return"";const a=new Date(e),i=new Date;let o=i.getFullYear()-a.getFullYear(),s=i.getMonth()-a.getMonth(),c=i.getDate()-a.getDate();if((s<0||s===0&&c<0)&&(o--,s+=12),c<0){const n=new Date(i.getFullYear(),i.getMonth(),0);c+=n.getDate(),s--}return`${o} aÃ±os, ${s} meses, ${c} dÃ­as`},G="meet.jit.si",Oe=({isOpen:e,onClose:a,roomName:i,displayName:o,appointmentId:s})=>{const c=j.useRef(null),n=j.useRef(null),[u,m]=j.useState(!0),[r,d]=j.useState(null),[x,y]=j.useState(0),[I,R]=j.useState(!1),H=`HistoriaClinica${s.replace(/[^a-zA-Z0-9]/g,"")}`,Y=async()=>{try{if(m(!0),d(null),window.JitsiMeetExternalAPI||await new Promise((C,K)=>{const W=document.querySelector('script[src*="external_api.js"]');W&&W.remove();const P=document.createElement("script");P.src=`https://${G}/external_api.js`,P.async=!0,P.onload=()=>{console.log("Jitsi script loaded successfully"),C()},P.onerror=()=>K(new Error("No se pudo cargar el script de video")),document.head.appendChild(P)}),await new Promise(C=>setTimeout(C,300)),!c.current)throw new Error("Container not ready");n.current&&(n.current.dispose(),n.current=null),console.log("Creating Jitsi room:",H),n.current=new window.JitsiMeetExternalAPI(G,{roomName:H,parentNode:c.current,width:"100%",height:"100%",configOverwrite:{prejoinPageEnabled:!1,prejoinConfig:{enabled:!1},enableLobby:!1,hideLobbyButton:!0,startWithAudioMuted:!1,startWithVideoMuted:!1,disableDeepLinking:!0,enableWelcomePage:!1,enableClosePage:!1,disableInviteFunctions:!0,hideConferenceSubject:!1,subject:"Consulta MÃ©dica Virtual",enableInsecureRoomNameWarning:!1,requireDisplayName:!1,p2p:{enabled:!0},fileRecordingsEnabled:!1,liveStreamingEnabled:!1,breakoutRooms:{hideAddRoomButton:!0,hideAutoAssignButton:!0,hideJoinRoomButton:!0}},interfaceConfigOverwrite:{TOOLBAR_BUTTONS:["microphone","camera","desktop","fullscreen","hangup","chat","settings","videoquality","tileview","toggle-camera"],SHOW_JITSI_WATERMARK:!1,SHOW_WATERMARK_FOR_GUESTS:!1,SHOW_BRAND_WATERMARK:!1,BRAND_WATERMARK_LINK:"",DEFAULT_BACKGROUND:"#1a1a2e",DISABLE_JOIN_LEAVE_NOTIFICATIONS:!1,MOBILE_APP_PROMO:!1,HIDE_INVITE_MORE_HEADER:!0,DISABLE_FOCUS_INDICATOR:!0,SHOW_PROMOTIONAL_CLOSE_PAGE:!1,ENABLE_FEEDBACK_ANIMATION:!1,TOOLBAR_ALWAYS_VISIBLE:!1,INITIAL_TOOLBAR_TIMEOUT:15e3,TOOLBAR_TIMEOUT:4e3},userInfo:{displayName:o||"Participante"}}),console.log("JaaS API created, adding listeners..."),n.current.addListener("videoConferenceJoined",C=>{console.log("User joined video conference:",C),m(!1)}),n.current.addListener("videoConferenceLeft",()=>{console.log("User left video conference"),a()}),n.current.addListener("readyToClose",()=>{console.log("Ready to close"),a()}),setTimeout(()=>{m(!1)},5e3)}catch(C){console.error("JaaS initialization error:",C),d(C.message||"Error al iniciar la video consulta"),m(!1)}};j.useEffect(()=>{if(!e){n.current&&(n.current.dispose(),n.current=null),m(!0),d(null);return}return Y(),()=>{n.current&&(n.current.dispose(),n.current=null)}},[e,s,x]);const J=()=>{y(C=>C+1)},B=()=>{R(!I)};return e?t.jsx(q,{children:e&&t.jsxs($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] bg-black flex flex-col",children:[!I&&t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-gradient-to-r from-purple-900 to-indigo-900 border-b border-white/10",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-1.5 bg-white/10 rounded-lg",children:t.jsx(se,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-sm font-bold text-white",children:"Video Consulta"}),t.jsxs("p",{className:"text-[10px] text-purple-200",children:[o," â€¢ ID: ",H.slice(-8)]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:B,className:"p-1.5 text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors",title:"Pantalla completa",children:t.jsx(ie,{size:18})}),t.jsx("button",{onClick:a,className:"p-1.5 text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:t.jsx(k,{size:18})})]})]}),I&&t.jsxs("div",{className:"absolute top-2 right-2 z-30 flex gap-2",children:[t.jsx("button",{onClick:B,className:"p-2 bg-black/50 text-white hover:bg-black/70 rounded-lg transition-colors",children:t.jsx(re,{size:20})}),t.jsx("button",{onClick:a,className:"p-2 bg-red-500/80 text-white hover:bg-red-500 rounded-lg transition-colors",children:t.jsx(k,{size:20})})]}),t.jsxs("div",{className:"flex-1 relative bg-gray-900",children:[u&&!r&&t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-b from-purple-900 to-indigo-900 z-20",children:[t.jsxs("div",{className:"relative mb-4",children:[t.jsx("div",{className:"w-14 h-14 border-4 border-white/20 rounded-full animate-pulse"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx(oe,{className:"w-7 h-7 text-white animate-bounce"})})]}),t.jsx("h3",{className:"text-base font-bold text-white mb-1",children:"Conectando..."}),t.jsx("p",{className:"text-purple-200 text-xs",children:"Iniciando video consulta"})]}),r&&t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-b from-red-900 to-red-800 z-20",children:[t.jsx(ne,{className:"w-10 h-10 text-white mb-4"}),t.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Error de ConexiÃ³n"}),t.jsx("p",{className:"text-red-200 text-sm mb-4",children:r}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:J,className:"px-4 py-2 bg-white text-red-600 rounded-lg font-bold text-sm hover:bg-gray-100 transition-colors flex items-center gap-2",children:[t.jsx(ce,{size:16}),"Reintentar"]}),t.jsx("button",{onClick:a,className:"px-4 py-2 bg-white/20 text-white rounded-lg font-bold text-sm hover:bg-white/30 transition-colors",children:"Cerrar"})]})]}),t.jsx("div",{ref:c,className:"w-full h-full",style:{visibility:u||r?"hidden":"visible",position:"absolute",top:0,left:0,right:0,bottom:0}})]})]})}):null},De=["Sangrado digestivo","Dificultad para tragar","Dolor al tragar","Dispepsia","Reflujo","Gastritis","Ulcera","Dolor abdominal","Hernia","Vomitos","Enfermedad de Crohn","Colitis","Ulcerativa","Colon irritable","Sindrome diarreico","Constipacion","Distension abdominal","Perdida de peso","Anemia","PÃ³lipos","CÃ¡ncer","Ictericia","Cirrosis hepÃ¡tica","Calculo en via biliar","Intolerancia alimenticia","Masa abdominal","Diverticulitis","Hemorroides","Fisura anal","Pancreatitis","Colecistitis","Obesidad","Hallazgo radiologico anormal","Dolor anal","Picazon anal","Pared abdominal"],Re=["MigraÃ±a","Epilepsia","Accidente cerebrovascular","Aneurisma","Parkinson","Alzheimer","Tumores","Accidente isquemico transitorio","Esclerosis multiple","Demencia","Traumatismo","Neuropatia","Autismo"],Pe=["Obesidad","Colesterol y triglicÃ©ridos altos","Diabetes","Resistencia a la Insulina","Hipertiroidismo","Hipotiroidismo","Hipertension arterial"],_e=["Dermatitis","Psoriasis","Herpes","RosÃ¡cea","Eccema","Celulitis/Erisipela","Urticaria","Otros"],Le=["Asma","EPOC","Tuberculosis","Fibrosis pulmonar","Apnea del sueÃ±o","Cancer de pulmon","Trombosis pulmonar","Infec. respiratorias sup","Bronquitis","Neumonia","Cancer de vias respiratorias"],Me=["Hipertension arterial","Insuficiencia cardiaca","Infarto","Cardiopatia isquÃ©mica","Arritmias","Angina de pecho","Enfermedad valvular","Miocardiopatia","Cardiopatias congenita","Endocarditis"],ke=["Trastorno motor esofagico","Sangrado digestivo","Dispepsia","Reflujo","Gastritis","Ulcera","Enfermedad de Crohn","Colitis Ulcerativa","Colon irritable","Diarrea cronica","Constipacion cronica","PÃ³lipos","CÃ¡ncer","Intolerancia alimenticia","Disfagia neurogenica","Enfermedad diverticular","Hemorroides","Fisura anal","Fistula anal","Acalasia","SÃ­ndrome de malabsorciÃ³n"],He=["Higado graso","Hepatitis","Cirrosis","Cancer higado","Hemocromatosis","Litiasis vesicular","Litiasis de la via biliar","Colangitis esclerosante primaria","Pancreatitis","CÃ¡ncer","VÃ¡rices","Ictericia"],Fe=["Insuficiencia venosa","Varices","Trombosis venosa superficial","Trombosis venosa profunda","ObstrucciÃ³n arterial aguda o crÃ³nica","Aneurisma","Enfermedad carotidea"],ze=["Sangrados o hematomas frecuentes","Leucemia","Linfomas","Mieloma","Anemia","Hemofilia","PÃºrpura trombocitopÃ©nica idiopÃ¡tica","Trombofilia","Neutropenia","Sindrome mileodisplasico","Policitemia vera","Plaquetopenia","Trombocitosis"],qe=["Insuficiencia renal","Calculos","CÃ¡ncer","Infecciones a repeticion","Enfermedad renal diabÃ©tica","Enfermedad renal hipertensiva","Pielonefritis","Enfermedad quÃ­stica","Transplantado renal","Hiperplasia prostÃ¡tica benigna"],$e=["Lupus","Artritis","Artrosis","Esclerodermia","Fibromialgia","Gota","Osteoporosis","Polimialgia","Polimiositis","Esclerosis multiple","Sarcoidosis","Sd Antifosfolipidos","Vasculitis","Sindrome de Sjogren"],Be=["Malaria","VIH","Dengue","Sarampion","Hepatitis","Covid","Amigdalitis","ETS","Herpes","Parasitosis","Neumonia"],We=["Ansiedad","Depresion","Esquizofrenia","Trastorno bipolar","Ataques de panico","Intento de suicidio","Fobias","Alzheimer","Trastorno obsesivo compulsivo","Anorexia","Bulimia","TDAH"],Ue=["Miomas","Quistes de ovario","Endometriosis","Aborto","Preeclampsia","Infecciones vaginales","Eclampsia","Prolapso genital","Diabetes gestacional","CÃ¡ncer","SÃ­ndrome de ovario poliquÃ­stico","Embarazo ectÃ³pico","Infertilidad","Trastornos hormonales","Otros"],Ge=["Endometriosis","Miomas","Cancer cervicouterino","Prolapso uterino","Quistes de ovarios","Ovario poliquÃ­stico","Hemorragia disfuncional","Infecciones ginecologicas"],Ve=["Analgesicos","AntibiÃ³ticos","Protectores gÃ¡stricos","Antihipertensivos","Hipoglicemiantes","AntiarrÃ­tmicos","Anticoagulantes","Aspirina","Antigagregantes plaquetarios","Antiulcerosos","AntiÃ¡cidos","Antidepresivos","Antisicoticos","Ansioliticos"],Ye=["Medicamentos","Yodo","Latex","Anestesicos","Transfusiones sanguineas","Medio de contraste"],Je=["Leche","Mariscos","Huevo","Pescado","ManÃ­","Soja","Trigo","Frutos secos"],Ke=["Gluten","Lactosa","Fructosa","Histamina","Sorbitol","Salicilatos","Sacarosa"],Qe=["Tabaquismo","Alcohol","Drogas","Cafeina","Psicofarmacos","Vaping","Medicamentos controlados"],Xe=["Quimicos","Derivados del petroleo","Radiaciones","Mineria","Aserrin","Plomo","Pinturas","Venenos","Fertilizantes","Hierro y acero","Caucho","Aluminio","Derivados el alcohol"],Ze=["Cancer","Hipertiroidismo","Hipotiroidismo","Colitis ulcerativa","E. Crohn","Poliposis","Diabetes","Hipertension","Cardiopatia isquemica","Asma","EPOC","Epilepsia","Enf. Autoinmune"],et=["Colitis Ulcerativa","Enfermedad de Crohn","SÃ­ndrome polipÃ³sico","Cancer digestivo","Enfermedades autoinmunes digestivas"],xe=["Piel y anexos","Cabeza","Cuello","Torax","Cardiaco","Pulmonar","Abdomen","Miembros superiores","Miembros inferiores","Neurologico","Genitales","Tacto Rectal"],we="flex items-center space-x-3 p-2.5 rounded-lg border-2 border-gray-900 bg-white hover:bg-gray-50 transition-all cursor-pointer",ye="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2",tt=({items:e,data:a,onChange:i})=>t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 text-sm",children:e.map(o=>{const s=!!a[o];return t.jsxs("label",{className:`${we} ${s?"bg-blue-50 border-blue-100":""}`,children:[t.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${s?"bg-blue-600 border-gray-900":"bg-white border-gray-900"}`,children:s&&t.jsx(le,{size:12,className:"text-white"})}),t.jsx("input",{type:"checkbox",checked:s,onChange:c=>i(o,c.target.checked),className:"hidden"}),t.jsx("span",{className:`font-medium ${s?"text-blue-800":"text-gray-600"}`,children:o})]},o)})}),F=({label:e,checked:a,onClick:i})=>t.jsx("button",{type:"button",onClick:i,className:`px-4 py-1.5 rounded-full text-sm font-semibold transition-all shadow-sm ${a?"bg-blue-600 text-white ring-2 ring-blue-200":"bg-white text-gray-500 border-2 border-gray-900 hover:bg-gray-50"}`,children:e}),S=({label:e,value:a,onChange:i})=>t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between py-4 border-b border-gray-100 last:border-0 gap-3",children:[t.jsx("span",{className:"font-medium text-black",children:e}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(F,{label:"SI",checked:a.yes,onClick:()=>i("yes",!a.yes)}),t.jsx(F,{label:"NO",checked:a.no,onClick:()=>i("no",!a.no)}),a.na!==void 0&&t.jsx(F,{label:"N/A",checked:a.na,onClick:()=>i("na",!a.na)})]})]}),at=({data:e,onChange:a,hideVitals:i=!1})=>{const o=(s,c,n)=>{let u={...e.systems[s],[c]:n};c==="normal"&&n===!0?u.abnormal=!1:c==="abnormal"&&n===!0&&(u.normal=!1),a({...e,systems:{...e.systems,[s]:u}})};return t.jsxs("div",{className:"space-y-6 bg-white p-6 rounded-xl border border-gray-200 shadow-sm relative overflow-hidden",children:[t.jsx("h3",{className:ye,children:"V. Examen FÃ­sico"}),!i&&t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-9 gap-4 text-sm mb-8",children:["fc","fr","temp","pa","pam","sat02","weight","height","imc"].map(s=>t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"text-gray-500 text-[11px] uppercase font-bold mb-1.5 tracking-wider",children:s}),t.jsx("input",{className:"w-full px-3 py-2 bg-gray-50 border border-gray-200 text-gray-800 text-sm rounded-lg shadow-sm focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all outline-none text-center font-medium font-mono",value:e[s],onChange:c=>a({...e,[s]:c.target.value})})]},s))}),t.jsx("div",{className:"glass rounded-2xl overflow-hidden border border-white/20 shadow-lg",children:t.jsxs("table",{className:"w-full text-sm text-left",children:[t.jsx("thead",{className:"bg-[#154c8a]/5 text-[#154c8a] uppercase text-xs backdrop-blur-sm",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-4 font-bold tracking-wide",children:"Organos y Sistemas"}),t.jsx("th",{className:"p-4 text-center font-bold w-24",children:"Normal"}),t.jsx("th",{className:"p-4 text-center font-bold w-24",children:"Anormal"}),t.jsx("th",{className:"p-4 font-bold",children:"DescripciÃ³n"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-100/50",children:xe.map(s=>{var c,n,u,m;return t.jsxs("tr",{className:"hover:bg-white/40 transition-colors duration-200",children:[t.jsx("td",{className:"p-4 font-medium text-gray-700",children:s}),t.jsx("td",{className:"p-4 text-center",children:t.jsx("div",{className:"flex justify-center",children:t.jsx("input",{type:"checkbox",className:"w-5 h-5 appearance-none border border-gray-300 rounded-md checked:bg-[#154c8a] checked:border-[#154c8a] transition-all cursor-pointer relative after:content-[''] after:absolute after:hidden checked:after:block after:left-[6px] after:top-[2px] after:w-[6px] after:h-[10px] after:border-white after:border-r-2 after:border-b-2 after:rotate-45 shadow-sm",checked:((c=e.systems[s])==null?void 0:c.normal)||!1,onChange:r=>o(s,"normal",r.target.checked)})})}),t.jsx("td",{className:"p-4 text-center",children:t.jsx("div",{className:"flex justify-center",children:t.jsx("input",{type:"checkbox",className:"w-5 h-5 appearance-none border border-gray-300 rounded-md checked:bg-red-500 checked:border-red-500 transition-all cursor-pointer relative after:content-[''] after:absolute after:hidden checked:after:block after:left-[6px] after:top-[2px] after:w-[6px] after:h-[10px] after:border-white after:border-r-2 after:border-b-2 after:rotate-45 shadow-sm",checked:((n=e.systems[s])==null?void 0:n.abnormal)||!1,onChange:r=>o(s,"abnormal",r.target.checked)})})}),t.jsx("td",{className:"p-4",children:((u=e.systems[s])==null?void 0:u.abnormal)&&t.jsx("input",{className:"w-full bg-transparent border-b border-gray-300 focus:border-[#154c8a] focus:outline-none text-gray-700 placeholder-gray-400 py-1 transition-colors",placeholder:"Describir hallazgos...",value:((m=e.systems[s])==null?void 0:m.description)||"",onChange:r=>o(s,"description",r.target.value)})})]},s)})})]})})]})},ve=async(e,a)=>{let i=e;if(e.type.startsWith("image/"))try{i=await fe(e)}catch(u){console.warn("Image compression failed, uploading original:",u)}const o=`${Date.now()}_${i.name}`,s=ee(X,`${a}/${o}`),c=await te(s,i);return await ae(c.ref)},st=async(e,a)=>ve(e,`profiles/${a}`),it=e=>["image/jpeg","image/png","image/gif","image/webp"].includes(e.type),rt=(e,a=10)=>{const i=a*1024*1024;return e.size<=i},V={weightGainOnset:{childhood:!1,youth:!1,pregnancy:!1,menopause:!1,postEvent:!1,when:""},familyObesity:{yes:!1,no:!1,who:""},familyPathologies:{yes:!1,no:!1,who:""},previousTreatments:{yes:!1,no:!1,which:""},previousMeds:{yes:!1,no:!1,which:""},maxWeight:"",minWeight:"",reboundCause:"",previousActivity:{yes:!1,no:!1,which:""},currentActivity:{yes:!1,no:!1,which:""},qualityOfLifeAlteration:{yes:!1,no:!1,how:""},metrics:{height:"",currentWeight:"",currentImc:"",lostWeight:"",lostOverweightPercentage:"",lostImcExcessPercentage:"",desiredWeight:"",desiredImc:""}},ot=({isOpen:e,onClose:a,onSave:i,initialData:o})=>{const[s,c]=j.useState(V);j.useEffect(()=>{if(e){const r=o&&Object.keys(o).length>0&&o.weightGainOnset;c(r?o:V)}},[e,o]);const n=(r,d)=>{c(x=>({...x,[r]:d}))},u=(r,d,x)=>{c(y=>{const R={...y[r],[d]:x};return x&&(d==="yes"&&(R.no=!1),d==="no"&&(R.yes=!1)),{...y,[r]:R}})},m=()=>{i(s)};return e?t.jsx(q,{children:t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:t.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Historia de Obesidad"}),t.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-200 rounded-full transition-colors",children:t.jsx(k,{size:24,className:"text-gray-500"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-8 space-y-8",children:[t.jsxs("section",{children:[t.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Inicio de ganancia de peso"}),t.jsx("div",{className:"flex flex-wrap gap-4 mb-4",children:["NiÃ±ez","Juventud","Embarazo","Menopausia","Post evento"].map(r=>{const d=r==="NiÃ±ez"?"childhood":r==="Juventud"?"youth":r==="Embarazo"?"pregnancy":r==="Menopausia"?"menopause":"postEvent";return t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:s.weightGainOnset[d],onChange:x=>n("weightGainOnset",{...s.weightGainOnset,[d]:x.target.checked}),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-700",children:r})]},d)})}),t.jsx(f,{label:"Â¿CuÃ¡ndo?",value:s.weightGainOnset.when,onChange:r=>n("weightGainOnset",{...s.weightGainOnset,when:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"})]}),t.jsxs("div",{className:"border-t-2 border-gray-900 pt-6 space-y-6",children:[t.jsxs("div",{children:[t.jsx(S,{label:"Antecedente de Obesidad en familiares en primer grado",value:s.familyObesity,onChange:(r,d)=>u("familyObesity",r,d)}),s.familyObesity.yes&&t.jsx("div",{className:"mt-4",children:t.jsx(f,{label:"Â¿QuiÃ©n?",value:s.familyObesity.who,onChange:r=>n("familyObesity",{...s.familyObesity,who:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"})})]}),t.jsxs("div",{children:[t.jsx(S,{label:"Antecedentes patolÃ³gicos en familiares en primer grado",value:s.familyPathologies,onChange:(r,d)=>u("familyPathologies",r,d)}),s.familyPathologies.yes&&t.jsx("div",{className:"mt-4",children:t.jsx(f,{label:"Â¿QuiÃ©n?",value:s.familyPathologies.who,onChange:r=>n("familyPathologies",{...s.familyPathologies,who:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"})})]}),t.jsxs("div",{children:[t.jsx(S,{label:"Tratamientos previos para bajar de peso",value:s.previousTreatments,onChange:(r,d)=>u("previousTreatments",r,d)}),s.previousTreatments.yes&&t.jsx("div",{className:"mt-4",children:t.jsx(f,{label:"Â¿CuÃ¡l?",value:s.previousTreatments.which,onChange:r=>n("previousTreatments",{...s.previousTreatments,which:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"})})]}),t.jsxs("div",{children:[t.jsx(S,{label:"Medicamentos, suplementos nutricionales previos",value:s.previousMeds,onChange:(r,d)=>u("previousMeds",r,d)}),s.previousMeds.yes&&t.jsx("div",{className:"mt-4",children:t.jsx(f,{label:"Â¿CuÃ¡les?",value:s.previousMeds.which,onChange:r=>n("previousMeds",{...s.previousMeds,which:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 border-t-2 border-gray-900 pt-6",children:[t.jsx(f,{label:"Peso mÃ¡ximo alcanzado (kg)",value:s.maxWeight,onChange:r=>n("maxWeight",r.target.value),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"}),t.jsx(f,{label:"Peso mÃ­nimo alcanzado (kg)",value:s.minWeight,onChange:r=>n("minWeight",r.target.value),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"})]}),t.jsx(f,{label:"Causa de rebote",value:s.reboundCause,onChange:r=>n("reboundCause",r.target.value),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"}),t.jsxs("div",{className:"border-t-2 border-gray-900 pt-6 space-y-6",children:[t.jsxs("div",{children:[t.jsx(S,{label:"Actividad fÃ­sica previa",value:s.previousActivity,onChange:(r,d)=>u("previousActivity",r,d)}),s.previousActivity.yes&&t.jsx("div",{className:"mt-4",children:t.jsx(f,{label:"Â¿CuÃ¡l?",value:s.previousActivity.which,onChange:r=>n("previousActivity",{...s.previousActivity,which:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"})})]}),t.jsxs("div",{children:[t.jsx(S,{label:"Actividad fÃ­sica actual",value:s.currentActivity,onChange:(r,d)=>u("currentActivity",r,d)}),s.currentActivity.yes&&t.jsx("div",{className:"mt-4",children:t.jsx(f,{label:"Â¿CuÃ¡l?",value:s.currentActivity.which,onChange:r=>n("currentActivity",{...s.currentActivity,which:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"})})]}),t.jsxs("div",{children:[t.jsx(S,{label:"AlteraciÃ³n de calidad de vida y laboral",value:s.qualityOfLifeAlteration,onChange:(r,d)=>u("qualityOfLifeAlteration",r,d)}),s.qualityOfLifeAlteration.yes&&t.jsx("div",{className:"mt-4",children:t.jsx(f,{label:"Â¿CÃ³mo?",value:s.qualityOfLifeAlteration.how,onChange:r=>n("qualityOfLifeAlteration",{...s.qualityOfLifeAlteration,how:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"})})]})]}),t.jsxs("div",{className:"border-t-2 border-gray-900 pt-6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx(f,{label:"Talla (cm)",value:s.metrics.height,onChange:r=>n("metrics",{...s.metrics,height:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"}),t.jsx(f,{label:"Peso actual (kg)",value:s.metrics.currentWeight,onChange:r=>n("metrics",{...s.metrics,currentWeight:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"}),t.jsx(f,{label:"IMC actual",value:s.metrics.currentImc,onChange:r=>n("metrics",{...s.metrics,currentImc:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"}),t.jsx(f,{label:"Peso perdido",value:s.metrics.lostWeight,onChange:r=>n("metrics",{...s.metrics,lostWeight:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"}),t.jsx(f,{label:"% sobrepeso perdido",value:s.metrics.lostOverweightPercentage,onChange:r=>n("metrics",{...s.metrics,lostOverweightPercentage:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"}),t.jsx(f,{label:"% perdido exceso IMC",value:s.metrics.lostImcExcessPercentage,onChange:r=>n("metrics",{...s.metrics,lostImcExcessPercentage:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"}),t.jsx(f,{label:"Peso deseado (Kg)",value:s.metrics.desiredWeight,onChange:r=>n("metrics",{...s.metrics,desiredWeight:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"}),t.jsx(f,{label:"IMC deseado",value:s.metrics.desiredImc,onChange:r=>n("metrics",{...s.metrics,desiredImc:r.target.value}),wrapperClassName:"bg-white border-2 border-gray-900 rounded-xl"})]})]}),t.jsx("div",{className:"p-6 border-t border-gray-100 bg-gray-50 flex justify-end",children:t.jsxs("button",{onClick:m,className:"bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 flex items-center gap-2 shadow-lg shadow-blue-600/20 transition-all transform hover:scale-[1.02] active:scale-[0.98]",children:[t.jsx(de,{size:20})," Agregar"]})})]})})}):null},nt=({message:e,type:a,isVisible:i,onClose:o})=>(j.useEffect(()=>{if(i){const s=setTimeout(()=>{o()},4e3);return()=>clearTimeout(s)}},[i,o]),t.jsx(q,{children:i&&t.jsxs($.div,{initial:{opacity:0,y:50,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.9},className:`fixed bottom-6 right-6 z-[100] flex items-center gap-3 px-6 py-4 rounded-xl shadow-2xl backdrop-blur-md border ${a==="success"?"bg-green-600/90 border-green-500 text-white":"bg-red-600/90 border-red-500 text-white"}`,children:[t.jsx("div",{className:`p-1 rounded-full ${a==="success"?"bg-green-500":"bg-red-500"}`,children:a==="success"?t.jsx(ue,{size:20}):t.jsx(me,{size:20})}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"font-bold text-sm",children:a==="success"?"Ã‰xito":"Error"}),t.jsx("span",{className:"text-sm opacity-90 font-medium",children:e})]}),t.jsx("button",{onClick:o,className:"ml-4 p-1 hover:bg-white/20 rounded-full transition-colors",children:t.jsx(k,{size:16})})]})}));export{Ye as A,tt as C,_e as D,Xe as E,Ke as F,ke as G,He as H,Be as I,Oe as J,De as M,Re as N,ot as O,Fe as P,Le as R,xe as S,nt as T,S as Y,Se as a,Pe as b,Te as c,Me as d,ze as e,qe as f,$e as g,We as h,it as i,Ue as j,Ge as k,Qe as l,Ze as m,at as n,Ve as o,Je as p,et as q,Ee as r,st as u,rt as v};
