import{j as e,v as E,V as f,N as A,K as z,e as $,w as M,O as P,Q as D}from"./ui-BeP2E2EB.js";import{b as T,a as F,r as i}from"./vendor-CGaW2js3.js";import{a as j}from"./index-1xibhE-N.js";import{M as R,O as H}from"./Toast-D6DPPvL2.js";import"./firebase-BCTgdpS7.js";import"./FloatingLabelInput-Bllz3MGy.js";import"./utils-CDN07tui.js";const o="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 text-gray-800 text-sm rounded-lg focus:ring-4 focus:ring-green-100 focus:border-green-500 block transition-all duration-200 outline-none placeholder-gray-400 hover:bg-white",Q=()=>{const{patientId:n}=T(),p=F(),[c,v]=i.useState(null),[y,C]=i.useState(!0),[d,g]=i.useState(!1),[w,m]=i.useState(!1),[k,b]=i.useState(!1),[x,S]=i.useState({}),[a,u]=i.useState({date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().slice(0,5),motivos:[],motivoOtro:"",tiempoEvolucion:"",historiaEnfermedadActual:"",fc:"",fr:"",temp:"",pa:"",pam:"",sat02:"",peso:"",talla:"",imc:"",piel:"Normal",pielNota:"",cabeza:"Normal",cabezaNota:"",cuello:"Normal",cuelloNota:"",torax:"Normal",toraxNota:"",cardiaco:"Normal",cardiacoNota:"",pulmonar:"Normal",pulmonarNota:"",abdomen:"Normal",abdomenNota:"",miembrosSup:"Normal",miembrosSupNota:"",miembrosInf:"Normal",miembrosInfNota:"",neuro:"Normal",neuroNota:"",genitales:"Normal",genitalesNota:"",tactoRectal:"Normal",tactoRectalNota:"",diagnostico:"",medicamentos:"",alimentos:"",examenes:"",indicaciones:"",comentarios:"",proximaCita:"",consultationCost:""});i.useEffect(()=>{(async()=>{if(n)try{const l=await j.getPatient(n);v(l)}catch(l){console.error("Error loading patient:",l)}finally{C(!1)}})()},[n]),i.useEffect(()=>{const t=parseFloat(a.peso),l=parseFloat(a.talla)/100;if(t>0&&l>0){const r=(t/(l*l)).toFixed(2);u(I=>({...I,imc:r}))}},[a.peso,a.talla]);const O=t=>t<18.5?"Bajo peso":t<25?"Peso normal":t<30?"Sobrepeso":t<35?"Obesidad clase I":t<40?"Obesidad clase II":"Obesidad clase III (mÃ³rbida)",s=(t,l)=>{u(r=>({...r,[t]:l}))},h=t=>{u(l=>({...l,motivos:l.motivos.includes(t)?l.motivos.filter(r=>r!==t):[...l.motivos,t]}))},N=async()=>{if(n){g(!0);try{const t={patientId:n,date:a.date,time:a.time,motives:a.motivos.reduce((l,r)=>({...l,[r]:!0}),{}),otherMotive:a.motivoOtro,evolutionTime:a.tiempoEvolucion,physicalExam:{fc:a.fc,fr:a.fr,temp:a.temp,pa:a.pa,pam:a.pam,sat02:a.sat02,weight:a.peso,height:a.talla,imc:a.imc,piel:a.piel,pielNota:a.pielNota,cabeza:a.cabeza,cabezaNota:a.cabezaNota,cuello:a.cuello,cuelloNota:a.cuelloNota,torax:a.torax,toraxNota:a.toraxNota,cardiaco:a.cardiaco,cardiacoNota:a.cardiacoNota,pulmonar:a.pulmonar,pulmonarNota:a.pulmonarNota,abdomen:a.abdomen,abdomenNota:a.abdomenNota,miembrosSup:a.miembrosSup,miembrosSupNota:a.miembrosSupNota,miembrosInf:a.miembrosInf,miembrosInfNota:a.miembrosInfNota,neuro:a.neuro,neuroNota:a.neuroNota,genitales:a.genitales,genitalesNota:a.genitalesNota,tactoRectal:a.tactoRectal,tactoRectalNota:a.tactoRectalNota,systems:{}},diagnosis:a.diagnostico,treatment:{meds:a.medicamentos?[a.medicamentos]:[],food:a.alimentos,exams:a.examenes?[a.examenes]:[],norms:a.indicaciones?[a.indicaciones]:[]},comments:a.comentarios,nextAppointment:a.proximaCita,consultationCost:parseFloat(a.consultationCost)||0,createdAt:new Date().toISOString(),historyOfPresentIllness:a.historiaEnfermedadActual,labs:{performed:{yes:!1,no:!0},results:""},diagnoses:a.diagnostico?[a.diagnostico]:[]};await j.createConsult(t),p(`/app/profile/${n}`)}catch(t){console.error("Error saving consult:",t),alert("Error al guardar la consulta")}finally{g(!1)}}};return y?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Cargando..."}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>p(-1),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(E,{size:24,className:"text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Nueva Consulta Subsecuente"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[c==null?void 0:c.firstName," ",c==null?void 0:c.lastName]})]})]}),e.jsxs("button",{onClick:N,disabled:d,className:"bg-green-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-700 transition-colors flex items-center gap-2 disabled:opacity-50",children:[e.jsx(f,{size:18})," ",d?"Guardando...":"Guardar Consulta"]})]})}),e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-8 space-y-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-200",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(A,{className:"text-blue-600"})," InformaciÃ³n de la Consulta"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-600 mb-1",children:"Fecha"}),e.jsx("input",{type:"date",value:a.date,onChange:t=>s("date",t.target.value),className:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-600 mb-1",children:"Hora"}),e.jsx("input",{type:"time",value:a.time,onChange:t=>s("time",t.target.value),className:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-600 mb-1",children:"Tiempo de EvoluciÃ³n"}),e.jsx("input",{type:"text",value:a.tiempoEvolucion,onChange:t=>s("tiempoEvolucion",t.target.value),className:o,placeholder:"Ej: 3 meses"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-200",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Motivos de Consulta"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:R.map(t=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{t==="Obesidad"?(m(!0),a.motivos.includes(t)||h(t)):h(t)},className:`px-3 py-1.5 rounded-full text-sm font-medium border transition-colors ${a.motivos.includes(t)?"bg-green-600 text-white border-green-600":"bg-white text-gray-700 border-gray-300 hover:border-green-400"}`,children:t}),t==="Obesidad"&&a.motivos.includes("Obesidad")&&Object.keys(x).length>0&&e.jsx("button",{type:"button",onClick:()=>b(!0),className:"p-1.5 bg-purple-100 text-purple-700 rounded-full hover:bg-purple-200 transition",title:"Ver Historia de Obesidad",children:e.jsx(z,{size:14})})]},t))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-600 mb-1",children:"Otro motivo"}),e.jsx("input",{type:"text",value:a.motivoOtro,onChange:t=>s("motivoOtro",t.target.value),className:o,placeholder:"Especifique..."})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-600 mb-1",children:"Historia de la enfermedad actual"}),e.jsx("textarea",{value:a.historiaEnfermedadActual,onChange:t=>s("historiaEnfermedadActual",t.target.value),className:`${o} min-h-[120px] resize-y`,placeholder:"Describa la historia de la enfermedad actual del paciente...",rows:5})]})]}),e.jsxs("div",{className:"bg-blue-50 p-6 rounded-2xl border border-blue-200",children:[e.jsxs("h2",{className:"text-lg font-bold text-blue-800 mb-4 flex items-center gap-2",children:[e.jsx($,{className:"text-blue-600"})," Signos Vitales"]}),e.jsxs("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"FC (lpm)"}),e.jsx("input",{type:"text",value:a.fc,onChange:t=>s("fc",t.target.value),className:o,placeholder:"72"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"FR (rpm)"}),e.jsx("input",{type:"text",value:a.fr,onChange:t=>s("fr",t.target.value),className:o,placeholder:"16"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"Temp (Â°C)"}),e.jsx("input",{type:"text",value:a.temp,onChange:t=>s("temp",t.target.value),className:o,placeholder:"36.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"PA (mmHg)"}),e.jsx("input",{type:"text",value:a.pa,onChange:t=>s("pa",t.target.value),className:o,placeholder:"120/80"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"SatO2 (%)"}),e.jsx("input",{type:"text",value:a.sat02,onChange:t=>s("sat02",t.target.value),className:o,placeholder:"98"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"PAM"}),e.jsx("input",{type:"text",value:a.pam,onChange:t=>s("pam",t.target.value),className:o,placeholder:"93"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"Peso (kg)"}),e.jsx("input",{type:"number",value:a.peso,onChange:t=>s("peso",t.target.value),className:o,placeholder:"70"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"Talla (cm)"}),e.jsx("input",{type:"number",value:a.talla,onChange:t=>s("talla",t.target.value),className:o,placeholder:"170"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"IMC"}),e.jsx("input",{type:"text",value:a.imc,readOnly:!0,className:`${o} bg-blue-100 font-bold`}),a.imc&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1 font-medium",children:[a.imc," - ",O(parseFloat(a.imc))]})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-200",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"text-purple-600"})," Examen FÃ­sico por Sistemas"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{key:"piel",label:"Piel"},{key:"cabeza",label:"Cabeza"},{key:"cuello",label:"Cuello"},{key:"torax",label:"TÃ³rax"},{key:"cardiaco",label:"CardÃ­aco"},{key:"pulmonar",label:"Pulmonar"},{key:"abdomen",label:"Abdomen"},{key:"miembrosSup",label:"Miembros Superiores"},{key:"miembrosInf",label:"Miembros Inferiores"},{key:"neuro",label:"NeurolÃ³gico"},{key:"genitales",label:"Genitales"},{key:"tactoRectal",label:"Tacto Rectal"}].map(({key:t,label:l})=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:l}),e.jsxs("select",{value:a[t],onChange:r=>s(t,r.target.value),className:`${o} ${a[t]==="Anormal"?"border-red-300 bg-red-50":""}`,children:[e.jsx("option",{value:"Normal",children:"Normal"}),e.jsx("option",{value:"Anormal",children:"Anormal"}),e.jsx("option",{value:"No evaluado",children:"No evaluado"})]})]}),a[t]==="Anormal"&&e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-bold text-red-600 mb-1",children:"Hallazgos"}),e.jsx("input",{type:"text",value:a[`${t}Nota`],onChange:r=>s(`${t}Nota`,r.target.value),className:`${o} border-red-300`,placeholder:"Describir..."})]})]},t))})]}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-2xl border border-green-200",children:[e.jsxs("h2",{className:"text-lg font-bold text-green-800 mb-4 flex items-center gap-2",children:[e.jsx(P,{className:"text-green-600"})," DiagnÃ³stico"]}),e.jsx("textarea",{value:a.diagnostico,onChange:t=>s("diagnostico",t.target.value),className:`${o} min-h-[120px]`,placeholder:`1. DiagnÃ³stico principal
2. DiagnÃ³sticos secundarios...`})]}),e.jsxs("div",{className:"bg-purple-50 p-6 rounded-2xl border border-purple-200",children:[e.jsxs("h2",{className:"text-lg font-bold text-purple-800 mb-4 flex items-center gap-2",children:[e.jsx(D,{className:"text-purple-600"})," Tratamiento"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-1",children:"Medicamentos"}),e.jsx("textarea",{value:a.medicamentos,onChange:t=>s("medicamentos",t.target.value),className:`${o} min-h-[100px]`,placeholder:"1. Medicamento, dosis, vÃ­a, frecuencia..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-1",children:"AlimentaciÃ³n"}),e.jsx("textarea",{value:a.alimentos,onChange:t=>s("alimentos",t.target.value),className:`${o} min-h-[80px]`,placeholder:"Indicaciones dietÃ©ticas..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-1",children:"Estudios Solicitados"}),e.jsx("textarea",{value:a.examenes,onChange:t=>s("examenes",t.target.value),className:`${o} min-h-[80px]`,placeholder:"Laboratorios, imÃ¡genes..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-1",children:"Indicaciones Generales"}),e.jsx("textarea",{value:a.indicaciones,onChange:t=>s("indicaciones",t.target.value),className:`${o} min-h-[80px]`,placeholder:"Reposo, actividades..."})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-600 mb-1",children:"Comentarios del MÃ©dico"}),e.jsx("textarea",{value:a.comentarios,onChange:t=>s("comentarios",t.target.value),className:`${o} min-h-[100px]`,placeholder:"Notas adicionales..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-600 mb-1",children:"PrÃ³xima Cita"}),e.jsx("input",{type:"text",value:a.proximaCita,onChange:t=>s("proximaCita",t.target.value),className:o,placeholder:"Ej: 1 mes con resultados"})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t-2 border-green-200",children:[e.jsx("label",{className:"block text-lg font-bold text-green-700 mb-2",children:"ðŸ’° Costo de Consulta"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-green-600",children:"$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:a.consultationCost,onChange:t=>s("consultationCost",t.target.value),placeholder:"0.00",className:"w-48 px-4 py-3 bg-white border-3 border-green-400 text-green-800 text-xl font-bold rounded-xl focus:ring-4 focus:ring-green-200 focus:border-green-500 outline-none transition-all placeholder-green-300"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:N,disabled:d,className:"bg-green-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-green-700 transition-colors flex items-center gap-2 shadow-lg disabled:opacity-50",children:[e.jsx(f,{size:20})," ",d?"Guardando...":"Guardar Consulta Subsecuente"]})})]}),e.jsx(H,{isOpen:w,onClose:()=>m(!1),onSave:t=>{S(t),m(!1)},initialData:x}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b bg-gradient-to-r from-purple-600 to-purple-700 text-white",children:[e.jsx("h3",{className:"text-xl font-bold",children:"ðŸ“Š Historia de Obesidad"}),e.jsx("button",{onClick:()=>b(!1),className:"p-2 hover:bg-white/20 rounded-full",children:"âœ•"})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:Object.keys(x).length>0?e.jsx("div",{className:"space-y-3",children:Object.entries(x).map(([t,l])=>l&&e.jsxs("div",{className:"flex items-start gap-2 bg-purple-50 p-3 rounded-lg border border-purple-200",children:[e.jsx("span",{className:"text-purple-600 font-bold",children:"âœ“"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-800 capitalize",children:t.replace(/([A-Z])/g," $1").trim()}),typeof l=="string"&&l!=="true"&&e.jsx("p",{className:"text-gray-600 text-sm",children:l})]})]},t))}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No hay datos de obesidad registrados"})}),e.jsx("div",{className:"p-4 border-t",children:e.jsx("button",{onClick:()=>{b(!1),m(!0)},className:"w-full py-2 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 transition",children:"Editar Historia de Obesidad"})})]})})]})};export{Q as CreateSubsecuenteScreen};
